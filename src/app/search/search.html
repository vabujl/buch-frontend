<div class="search-page space-y-6">
  <div class="alert alert-info">
    <div>
      <div class="font-semibold">Buecher suchen</div>
      <div class="text-sm opacity-70">Finde Titel oder ISBN.</div>
    </div>
  </div>

  <div class="card bg-base-100 shadow">
    <div class="card-body space-y-4">
      <div class="flex items-center justify-between gap-4">
        <h2 class="card-title">Suche</h2>
        <div class="text-sm opacity-70">Backend-Parameter</div>
      </div>

      <form class="grid grid-cols-1 md:grid-cols-3 gap-4" [formGroup]="form" (submit)="onSearch($event)" novalidate>
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Titel</span>
          </div>
          <input
            class="input input-bordered w-full"
            type="text"
            name="titel"
            placeholder="Titel"
            formControlName="titel"
            autocomplete="off"
          />
        </label>

        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">ISBN</span>
          </div>
          <input
            class="input input-bordered w-full"
            type="text"
            name="isbn"
            placeholder="z. B. 978"
            formControlName="isbn"
            autocomplete="off"
          />
        </label>

        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Buchart</span>
          </div>
          <select class="select select-bordered w-full" name="art" formControlName="art">
            <option value="">Alle</option>
            <option value="EPUB">EPUB</option>
            <option value="HARDCOVER">HARDCOVER</option>
            <option value="PAPERBACK">PAPERBACK</option>
          </select>
        </label>

        <div class="md:col-span-1">
          <div class="label">
            <span class="label-text">Optionen</span>
          </div>
          <label class="label cursor-pointer justify-start gap-2">
            <input type="checkbox" class="checkbox" name="lieferbar" formControlName="lieferbar" />
            <span class="label-text">Nur verfuegbare</span>
          </label>
        </div>

        <div class="md:col-span-3">
          <details class="border border-base-300 rounded-xl p-4">
            <summary class="cursor-pointer font-semibold">Erweiterte Filter</summary>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 pt-4">
              <label class="form-control w-full">
                <div class="label">
                  <span class="label-text">Rating</span>
                </div>
                <input
                  class="input input-bordered w-full"
                  type="number"
                  min="0"
                  max="5"
                  name="rating"
                  formControlName="rating"
                />
              </label>
              <label class="form-control w-full">
                <div class="label"><span class="label-text">Preis</span></div>
                <input
                  class="input input-bordered w-full"
                  type="number"
                  min="0"
                  step="0.01"
                  name="preis"
                  formControlName="preis"
                />
              </label>
              <label class="form-control w-full">
                <div class="label"><span class="label-text">Rabatt</span></div>
                <input
                  class="input input-bordered w-full"
                  type="number"
                  min="0"
                  max="1"
                  step="0.01"
                  name="rabatt"
                  formControlName="rabatt"
                />
              </label>
              <label class="form-control w-full">
                <div class="label"><span class="label-text">Datum</span></div>
                <input class="input input-bordered w-full" type="date" name="datum" formControlName="datum" />
              </label>
              <label class="form-control w-full md:col-span-2">
                <div class="label"><span class="label-text">Homepage</span></div>
                <input
                  class="input input-bordered w-full"
                  type="url"
                  name="homepage"
                  placeholder="https://example.com"
                  formControlName="homepage"
                />
              </label>
              <div class="md:col-span-3">
                <div class="label">
                  <span class="label-text">Schlagwoerter</span>
                </div>
                <div class="flex flex-wrap gap-4">
                  <label class="label cursor-pointer gap-2">
                    <input type="checkbox" class="checkbox" name="javascript" formControlName="javascript" />
                    <span class="label-text">JavaScript</span>
                  </label>
                  <label class="label cursor-pointer gap-2">
                    <input type="checkbox" class="checkbox" name="typescript" formControlName="typescript" />
                    <span class="label-text">TypeScript</span>
                  </label>
                </div>
              </div>
            </div>
          </details>
        </div>

        <div class="md:col-span-3 flex flex-wrap items-center gap-2 justify-end">
          <button class="btn btn-ghost" type="button" (click)="onReset()">Zuruecksetzen</button>
          <button class="btn btn-primary" type="submit" [disabled]="loading()">Suche</button>
        </div>
      </form>
    </div>
  </div>

  @if (loading()) {
  <div class="alert">
    <span class="loading loading-spinner"></span>
    <span>Suche laeuft.</span>
  </div>
  }
  @if (error()) {
  <div class="alert alert-error">
    <span class="font-semibold">Fehler:</span>
    <span>{{ error() }}</span>
  </div>
  }

  <div class="card bg-base-100 shadow">
    <div class="card-body space-y-4">
      <div class="flex items-center justify-between gap-4">
        <h2 class="card-title">Suchergebnisse</h2>
        @if (total() !== null) {
        <div class="text-sm opacity-70">{{ total() }} Treffer</div>
        }
      </div>

      @if (!loading() && !error()) {
        @if (books().length === 0) {
        <div class="alert">
          <span>Keine Treffer. Passe die Suche an.</span>
        </div>
        } @else {
        <div class="space-y-3">
          @for (book of books(); track book.id) {
          <div class="border border-base-300 rounded-xl p-4">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="font-semibold">{{ book.titel }}</div>
                <div class="text-sm opacity-70">
                  @if (book.autor) {
                  <span>{{ book.autor }} - </span>
                  }
                  {{ book.isbn }}
                </div>
              </div>
              <button class="btn btn-outline btn-sm" type="button" (click)="openDetails(book.id)">
                Details
              </button>
            </div>
          </div>
          }
        </div>
        }
      }

      @if (totalPages() > 1) {
      <div class="flex items-center justify-between pt-2">
        <div class="join">
          <button class="btn btn-sm join-item" type="button" (click)="gotoPage(1)" [disabled]="page() === 1 || loading()">
            <<
          </button>
          <button
            class="btn btn-sm join-item"
            type="button"
            (click)="gotoPage(page() - 1)"
            [disabled]="page() === 1 || loading()"
          >
            Zurueck
          </button>
        </div>
        <div class="text-sm opacity-70">Seite {{ page() }} / {{ totalPages() }}</div>
        <div class="join">
          <button
            class="btn btn-sm join-item"
            type="button"
            (click)="gotoPage(page() + 1)"
            [disabled]="page() === totalPages() || loading()"
          >
            Weiter
          </button>
          <button
            class="btn btn-sm join-item"
            type="button"
            (click)="gotoPage(totalPages())"
            [disabled]="page() === totalPages() || loading()"
          >
            >>
          </button>
        </div>
      </div>
      }
    </div>
  </div>
</div>
